# -*- coding: utf-8 -*-
from pathlib import Path
text = Path('app.py').read_text(encoding='utf-8')
old_block = """    if isinstance(ticker, dict) and ticker.get("price") is not None:\n        pct = ticker.get("change_pct") or 0.0\n        color = "#16c784" if pct >= 0 else "#ea3943"\n        kpi_block("Price", f"{ticker['price']:,.2f} $", color=color, help_text=f"High {ticker['high']:.0f} / Low {ticker['low']:.0f}")\n        price_eur = _as_float(ticker.get("price_eur"))\n        if price_eur is not None:\n            pct_eur = _as_float(ticker.get("change_pct_eur")) or 0.0\n            color_eur = "#16c784" if pct_eur >= 0 else "#ea3943"\n            high_eur = _as_float(ticker.get("high_eur"))\n            low_eur = _as_float(ticker.get("low_eur"))\n            help_eur = None\n            if high_eur is not None and low_eur is not None:\n                help_eur = f"High {high_eur:,.0f} / Low {low_eur:,.0f}"\n            kpi_block("Price (EUR)", f"{price_eur:,.2f} ?", color=color_eur, help_text=help_eur)\n        kpi_block("Variation 24 h", f"{pct:+.2f} %")\n        kpi_block("Volume 24 h", f"{ticker['volume']:.2f}")\n    else:\n        st.error(f"Impossible de récupérer le ticker: {ticker.get('error') if isinstance(ticker, dict) else 'unknown error'}")\n"""
new_block = """    if isinstance(ticker, dict) and ticker.get("price") is not None:\n        pct = ticker.get("change_pct") or 0.0\n        color = "#16c784" if pct >= 0 else "#ea3943"\n        kpi_block("Prix (USD)", f"{ticker['price']:,.2f} $", color=color, help_text=f"Plus haut {ticker['high']:.0f} / Plus bas {ticker['low']:.0f}")\n        price_eur = _as_float(ticker.get("price_eur"))\n        if price_eur is not None:\n            pct_eur = _as_float(ticker.get("change_pct_eur")) or 0.0\n            color_eur = "#16c784" if pct_eur >= 0 else "#ea3943"\n            high_eur = _as_float(ticker.get("high_eur"))\n            low_eur = _as_float(ticker.get("low_eur"))\n            help_eur = None\n            if high_eur is not None and low_eur is not None:\n                help_eur = f"Plus haut {high_eur:,.0f} / Plus bas {low_eur:,.0f}"\n            kpi_block("Prix (EUR)", f"{price_eur:,.2f} €", color=color_eur, help_text=help_eur)\n        kpi_block("Variation 24 h", f"{pct:+.2f} %", color=color)\n        kpi_block("Volume 24 h", f"{ticker['volume']:.2f}")\n    else:\n        st.error(f"Impossible de récupérer le ticker : {ticker.get('error') if isinstance(ticker, dict) else 'erreur inconnue'}")\n"""
if old_block not in text:
    raise SystemExit('price block not found')
Path('app.py').write_text(text.replace(old_block, new_block), encoding='utf-8')
